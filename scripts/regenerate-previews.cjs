/**
 * Regenerate auto-generated previews with unique, category-specific sample data.
 * Each API gets distinct sample data drawn from a pool of variants per category,
 * selected deterministically by hashing the slug.
 *
 * Skips hand-crafted previews (those with non-standard sampleResponse shapes).
 *
 * Usage: node scripts/regenerate-previews.cjs
 */

const fs = require("fs");
const path = require("path");
const crypto = require("crypto");

const catalogPath = path.join(__dirname, "..", "data", "catalog.json");
const previewDir = path.join(__dirname, "..", "data", "previews");
const catalog = JSON.parse(fs.readFileSync(catalogPath, "utf-8"));

function slugify(name) {
  return name.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/^-|-$/g, "");
}

/** Deterministic index from a slug string */
function hashIndex(slug, poolSize) {
  const h = crypto.createHash("md5").update(slug).digest();
  return h.readUInt32BE(0) % poolSize;
}

/**
 * Return true if the preview file was created by the old auto-generator
 * (sampleResponse contains api + description + category + auth fields).
 */
function isAutoGenerated(preview) {
  const s = preview.sampleResponse;
  return (
    s &&
    typeof s.api === "string" &&
    typeof s.description === "string" &&
    typeof s.category === "string" &&
    typeof s.auth !== "undefined"
  );
}

/**
 * Return true if the preview was created by the v2 generator
 * (has category-specific data but all in the same category share identical sampleResponse).
 * We detect this by checking for known template signatures.
 */
function isV2Generated(preview) {
  const s = preview.sampleResponse;
  if (!s) return false;
  // v2 templates all used these exact values
  const signatures = [
    s.location === "San Francisco, CA" && s.temperature === "18°C / 64°F",
    s.symbol === "AAPL" && s.price === "$182.63",
    s.name === "Bitcoin" && s.price_usd === "$67,432.18",
    s.address === "1600 Amphitheatre Pkwy",
    s.title === "The Legend of Zelda: Breath of the Wild",
    s.name === "Red Fox" && s.scientific_name === "Vulpes vulpes",
    s.name === "Pasta Carbonara",
    s.match === "Lakers vs Warriors",
    s.flight === "UA 328",
    s.element === "Carbon",
    s.title === "The Pragmatic Programmer",
    s.title === "Inception",
    s.title === "Attack on Titan",
    s.username === "@janedoe",
    s.condition === "Type 2 Diabetes",
    s.input === "The movie was absolutely fantastic!",
    s.text === "Elon Musk visited Tesla HQ in Austin.",
    s.base === "USD" && s.EUR === 0.9241,
    s.title === "Golden Gate at Dusk",
    s.location === "Los Angeles, CA" && s.aqi === 87,
    s.email === "user@example.com" && s.deliverable === true,
    s.quote === "The only way to do great work is to love what you do.",
    s.question === "What is the largest planet in our solar system?",
    s.name === "Alexandra Chen",
    s.repo === "facebook/react",
    s.ip === "192.168.1.1" && s.threat_score === 12,
    s.dataset === "US Population by State 2024",
    s.document === "Q4 2025 Report.pdf",
    s.product === "Sony WH-1000XM5 Headphones",
    s.tx_hash === "0x3a4e...9f2b",
    s.word === "ephemeral",
    s.palette === "Sunset Gradient",
    s.tracking_number === "1Z999AA10123456784",
    s.company === "Acme Corp",
    s.pipeline === "main-build",
    s.patent_number === "US10,123,456",
    s.event === "PyCon US 2026",
    s.endpoint && s.response_time === "142ms",
  ];
  return signatures.some(Boolean);
}

function shouldRegenerate(preview) {
  return isAutoGenerated(preview) || isV2Generated(preview);
}

// ── Variant Pools ────────────────────────────────────────────────────────────
// Each category has an array of sample data objects. APIs pick via hash.

const VARIANTS = {
  Weather: [
    { location: "San Francisco, CA", temperature: "18°C / 64°F", condition: "Partly Cloudy", humidity: "72%", wind: "14 km/h W" },
    { location: "Tokyo, Japan", temperature: "26°C / 79°F", condition: "Sunny", humidity: "58%", wind: "8 km/h SE" },
    { location: "London, UK", temperature: "12°C / 54°F", condition: "Overcast", humidity: "85%", wind: "22 km/h SW" },
    { location: "Sydney, Australia", temperature: "29°C / 84°F", condition: "Clear Sky", humidity: "45%", wind: "18 km/h NE" },
    { location: "Mumbai, India", temperature: "33°C / 91°F", condition: "Haze", humidity: "78%", wind: "11 km/h W" },
    { location: "Berlin, Germany", temperature: "8°C / 46°F", condition: "Light Rain", humidity: "91%", wind: "19 km/h NW" },
    { location: "Dubai, UAE", temperature: "38°C / 100°F", condition: "Clear", humidity: "32%", wind: "15 km/h N" },
    { location: "São Paulo, Brazil", temperature: "24°C / 75°F", condition: "Thunderstorm", humidity: "88%", wind: "6 km/h E" },
    { location: "New York, NY", temperature: "5°C / 41°F", condition: "Snow Showers", humidity: "76%", wind: "25 km/h NW" },
    { location: "Nairobi, Kenya", temperature: "22°C / 72°F", condition: "Scattered Clouds", humidity: "63%", wind: "10 km/h S" },
  ],
  Finance: [
    { symbol: "AAPL", price: "$182.63", change: "+1.24 (0.68%)", volume: "54.8M", market_cap: "$2.87T" },
    { symbol: "MSFT", price: "$417.88", change: "+3.52 (0.85%)", volume: "22.1M", market_cap: "$3.11T" },
    { symbol: "GOOGL", price: "$153.21", change: "-0.87 (-0.57%)", volume: "18.4M", market_cap: "$1.92T" },
    { symbol: "TSLA", price: "$248.50", change: "+12.30 (5.21%)", volume: "98.2M", market_cap: "$792B" },
    { symbol: "AMZN", price: "$185.07", change: "+2.11 (1.15%)", volume: "41.3M", market_cap: "$1.93T" },
    { symbol: "NVDA", price: "$875.30", change: "+18.45 (2.15%)", volume: "42.7M", market_cap: "$2.16T" },
    { symbol: "JPM", price: "$198.42", change: "-1.03 (-0.52%)", volume: "8.9M", market_cap: "$571B" },
    { symbol: "V", price: "$279.15", change: "+0.67 (0.24%)", volume: "6.2M", market_cap: "$573B" },
  ],
  Cryptocurrency: [
    { name: "Bitcoin", symbol: "BTC", price_usd: "$67,432.18", change_24h: "+3.41%", market_cap: "$1.33T" },
    { name: "Ethereum", symbol: "ETH", price_usd: "$3,521.07", change_24h: "+1.82%", market_cap: "$423B" },
    { name: "Solana", symbol: "SOL", price_usd: "$142.85", change_24h: "-2.14%", market_cap: "$63.2B" },
    { name: "Cardano", symbol: "ADA", price_usd: "$0.628", change_24h: "+0.93%", market_cap: "$22.3B" },
    { name: "Polkadot", symbol: "DOT", price_usd: "$7.84", change_24h: "-1.37%", market_cap: "$10.5B" },
    { name: "Avalanche", symbol: "AVAX", price_usd: "$38.92", change_24h: "+4.56%", market_cap: "$14.8B" },
    { name: "Chainlink", symbol: "LINK", price_usd: "$18.43", change_24h: "+2.08%", market_cap: "$10.8B" },
    { name: "XRP", symbol: "XRP", price_usd: "$0.5421", change_24h: "-0.32%", market_cap: "$29.5B" },
  ],
  Geocoding: [
    { address: "1600 Amphitheatre Pkwy", city: "Mountain View", country: "US", lat: 37.4224, lng: -122.0842 },
    { address: "10 Downing Street", city: "London", country: "GB", lat: 51.5034, lng: -0.1276 },
    { address: "1-1-1 Marunouchi", city: "Tokyo", country: "JP", lat: 35.6812, lng: 139.7671 },
    { address: "221B Baker Street", city: "London", country: "GB", lat: 51.5238, lng: -0.1585 },
    { address: "Champs-Élysées 101", city: "Paris", country: "FR", lat: 48.8698, lng: 2.3076 },
    { address: "Potsdamer Platz 1", city: "Berlin", country: "DE", lat: 52.5096, lng: 13.3761 },
    { address: "350 Fifth Avenue", city: "New York", country: "US", lat: 40.7484, lng: -73.9857 },
    { address: "Via della Conciliazione", city: "Rome", country: "IT", lat: 41.9022, lng: 12.4539 },
  ],
  Development: [
    { repo: "facebook/react", stars: "228K", forks: "46.8K", language: "JavaScript", open_issues: 891 },
    { repo: "vercel/next.js", stars: "124K", forks: "26.5K", language: "JavaScript", open_issues: 2841 },
    { repo: "microsoft/vscode", stars: "162K", forks: "28.7K", language: "TypeScript", open_issues: 7823 },
    { repo: "torvalds/linux", stars: "178K", forks: "53.1K", language: "C", open_issues: 341 },
    { repo: "denoland/deno", stars: "93.8K", forks: "5.2K", language: "Rust", open_issues: 1943 },
    { repo: "golang/go", stars: "122K", forks: "17.5K", language: "Go", open_issues: 9102 },
    { repo: "rust-lang/rust", stars: "96.2K", forks: "12.4K", language: "Rust", open_issues: 9647 },
    { repo: "python/cpython", stars: "62.1K", forks: "29.8K", language: "Python", open_issues: 8234 },
    { repo: "docker/compose", stars: "33.5K", forks: "5.2K", language: "Go", open_issues: 212 },
    { repo: "kubernetes/kubernetes", stars: "109K", forks: "39.2K", language: "Go", open_issues: 2431 },
  ],
  "Games & Comics": [
    { title: "The Legend of Zelda: TOTK", platform: "Switch", genre: "Action-Adventure", rating: "9.6 / 10" },
    { title: "Elden Ring", platform: "PC / PS5 / Xbox", genre: "Action RPG", rating: "9.5 / 10" },
    { title: "Baldur's Gate 3", platform: "PC / PS5", genre: "RPG", rating: "9.7 / 10" },
    { title: "Hades II", platform: "PC (Early Access)", genre: "Roguelike", rating: "9.0 / 10" },
    { title: "Cyberpunk 2077", platform: "PC / PS5 / Xbox", genre: "Action RPG", rating: "8.6 / 10" },
    { title: "Final Fantasy XVI", platform: "PS5 / PC", genre: "Action RPG", rating: "8.8 / 10" },
    { title: "Spider-Man 2", platform: "PS5", genre: "Action-Adventure", rating: "9.0 / 10" },
    { title: "Persona 5 Royal", platform: "Multi-platform", genre: "JRPG", rating: "9.4 / 10" },
    { title: "Hollow Knight: Silksong", platform: "PC / Switch", genre: "Metroidvania", rating: "TBD" },
    { title: "It Takes Two", platform: "Multi-platform", genre: "Co-op Adventure", rating: "8.9 / 10" },
  ],
  Animals: [
    { name: "Red Fox", scientific_name: "Vulpes vulpes", habitat: "Forest, Urban", diet: "Omnivore", conservation: "Least Concern" },
    { name: "Blue Whale", scientific_name: "Balaenoptera musculus", habitat: "Ocean", diet: "Krill", conservation: "Endangered" },
    { name: "Snow Leopard", scientific_name: "Panthera uncia", habitat: "Mountain", diet: "Carnivore", conservation: "Vulnerable" },
    { name: "Emperor Penguin", scientific_name: "Aptenodytes forsteri", habitat: "Antarctic", diet: "Fish, Squid", conservation: "Near Threatened" },
    { name: "Red Panda", scientific_name: "Ailurus fulgens", habitat: "Temperate Forest", diet: "Bamboo", conservation: "Endangered" },
    { name: "Axolotl", scientific_name: "Ambystoma mexicanum", habitat: "Freshwater Lakes", diet: "Worms, Insects", conservation: "Critically Endangered" },
    { name: "African Elephant", scientific_name: "Loxodonta africana", habitat: "Savanna", diet: "Herbivore", conservation: "Endangered" },
  ],
  "Machine Learning": [
    { input: "This movie was absolutely fantastic!", label: "POSITIVE", confidence: "98.7%", model: "distilbert-base", latency: "42ms" },
    { input: "Translate: Hello, how are you?", output: "Hola, ¿cómo estás?", source_lang: "en", target_lang: "es", model: "marian-mt" },
    { input: "The quick brown fox [MASK] over the lazy dog", predicted: "jumps", alternatives: "leaps, hops, ran", model: "bert-base", latency: "28ms" },
    { input: "[Photo of a cat on a sofa]", labels: "cat: 97.2%, furniture: 84.1%, indoor: 91.3%", model: "resnet-50", latency: "65ms" },
    { input: "cluster 500 customer records", clusters: 5, silhouette_score: 0.72, algorithm: "k-means", runtime: "1.2s" },
    { input: "Summarize: The European Union today announced…", output: "EU unveils new 2030 climate targets.", compression: "85%", model: "bart-large" },
    { input: "Is this email spam?", label: "NOT SPAM", confidence: "94.1%", model: "naive-bayes", features: 47 },
    { input: "Generate embedding for: neural networks", dimensions: 768, model: "all-MiniLM-L6-v2", similarity_to_nearest: 0.89 },
  ],
  Music: {
    type: "list",
    variants: [
      [
        { title: "Blinding Lights", artist: "The Weeknd", duration: "3:20" },
        { title: "Shape of You", artist: "Ed Sheeran", duration: "3:53" },
        { title: "Levitating", artist: "Dua Lipa", duration: "3:23" },
        { title: "Stay", artist: "The Kid LAROI", duration: "2:22" },
        { title: "Peaches", artist: "Justin Bieber", duration: "3:18" },
      ],
      [
        { title: "Bohemian Rhapsody", artist: "Queen", duration: "5:55" },
        { title: "Hotel California", artist: "Eagles", duration: "6:30" },
        { title: "Stairway to Heaven", artist: "Led Zeppelin", duration: "8:02" },
        { title: "Comfortably Numb", artist: "Pink Floyd", duration: "6:23" },
        { title: "Wish You Were Here", artist: "Pink Floyd", duration: "5:34" },
      ],
      [
        { title: "Espresso", artist: "Sabrina Carpenter", duration: "2:55" },
        { title: "Lunch", artist: "Billie Eilish", duration: "2:58" },
        { title: "Greedy", artist: "Tate McRae", duration: "2:31" },
        { title: "Water", artist: "Tyla", duration: "3:19" },
        { title: "Vampire", artist: "Olivia Rodrigo", duration: "3:39" },
      ],
      [
        { title: "So What", artist: "Miles Davis", duration: "9:22" },
        { title: "Take Five", artist: "Dave Brubeck", duration: "5:24" },
        { title: "My Favorite Things", artist: "John Coltrane", duration: "13:41" },
        { title: "Maiden Voyage", artist: "Herbie Hancock", duration: "7:59" },
        { title: "Blue in Green", artist: "Bill Evans", duration: "5:27" },
      ],
      [
        { title: "Neon", artist: "John Mayer", duration: "4:39" },
        { title: "Gravity", artist: "John Mayer", duration: "4:05" },
        { title: "Fast Car", artist: "Tracy Chapman", duration: "4:57" },
        { title: "Landslide", artist: "Fleetwood Mac", duration: "3:19" },
        { title: "Hallelujah", artist: "Jeff Buckley", duration: "6:53" },
      ],
    ],
  },
  News: {
    type: "list",
    variants: [
      [
        { title: "Global AI regulation talks resume in Geneva", source: "Reuters" },
        { title: "SpaceX Starship completes orbital test", source: "AP" },
        { title: "EU announces climate framework for 2030", source: "BBC" },
        { title: "Tech stocks rally on strong earnings", source: "Bloomberg" },
      ],
      [
        { title: "Breakthrough in solid-state battery tech", source: "Nature" },
        { title: "Fed holds interest rates steady at 5.25%", source: "WSJ" },
        { title: "Olympic committee announces 2036 host city", source: "AP" },
        { title: "Major cybersecurity breach affects millions", source: "Wired" },
      ],
      [
        { title: "WHO declares new vaccine initiative", source: "Reuters" },
        { title: "Renewable energy surpasses coal globally", source: "Guardian" },
        { title: "Mars rover discovers subsurface water ice", source: "NASA" },
        { title: "G7 summit produces trade agreement", source: "FT" },
      ],
      [
        { title: "Quantum computing milestone at IBM", source: "MIT Tech Review" },
        { title: "Record-breaking heatwave across southern Europe", source: "BBC" },
        { title: "New antibiotic class discovered in soil bacteria", source: "Science" },
        { title: "Global chip shortage finally easing", source: "CNBC" },
      ],
    ],
  },
  Jobs: {
    type: "list",
    variants: [
      [
        { title: "Senior Frontend Engineer", company: "Stripe", location: "Remote" },
        { title: "ML Engineer", company: "Anthropic", location: "San Francisco" },
        { title: "Product Designer", company: "Figma", location: "New York" },
        { title: "Backend Engineer", company: "Shopify", location: "Remote" },
      ],
      [
        { title: "DevOps Engineer", company: "Vercel", location: "Remote" },
        { title: "iOS Developer", company: "Apple", location: "Cupertino" },
        { title: "Data Scientist", company: "Spotify", location: "Stockholm" },
        { title: "SRE", company: "Google", location: "London" },
      ],
      [
        { title: "Full Stack Developer", company: "Linear", location: "Remote" },
        { title: "Security Engineer", company: "1Password", location: "Toronto" },
        { title: "Rust Engineer", company: "Cloudflare", location: "Austin" },
        { title: "Engineering Manager", company: "Notion", location: "San Francisco" },
      ],
    ],
  },
  Podcasts: {
    type: "list",
    variants: [
      [
        { title: "How AI is Reshaping Work", show: "Lex Fridman Podcast" },
        { title: "The Future of Open Source", show: "Software Unscripted" },
        { title: "Building in Public", show: "Indie Hackers" },
        { title: "Deep Dive: TypeScript 5.4", show: "Syntax.fm" },
      ],
      [
        { title: "Scaling to 1M Users", show: "Software Engineering Daily" },
        { title: "Why Rust Matters", show: "Rustacean Station" },
        { title: "Design Systems at Scale", show: "Design Details" },
        { title: "The State of Web3", show: "Bankless" },
      ],
    ],
  },
  Social: [
    { username: "@janedoe", display_name: "Jane Doe", followers: "142,803", posts: "3,241", verified: true },
    { username: "@devcraft", display_name: "DevCraft", followers: "52,100", posts: "1,847", verified: false },
    { username: "@sarahcodes", display_name: "Sarah Chen", followers: "284,921", posts: "5,102", verified: true },
    { username: "@techbro42", display_name: "Mike R.", followers: "8,342", posts: "921", verified: false },
    { username: "@pixelartist", display_name: "Luna Kim", followers: "1.2M", posts: "4,512", verified: true },
    { username: "@opensourcefan", display_name: "Alex Rivera", followers: "67,800", posts: "2,380", verified: true },
  ],
  "Food & Drink": [
    { name: "Pasta Carbonara", cuisine: "Italian", prep_time: "10 min", cook_time: "20 min", calories: "620 kcal" },
    { name: "Pad Thai", cuisine: "Thai", prep_time: "15 min", cook_time: "10 min", calories: "380 kcal" },
    { name: "Beef Tacos", cuisine: "Mexican", prep_time: "20 min", cook_time: "15 min", calories: "450 kcal" },
    { name: "Sushi Roll", cuisine: "Japanese", prep_time: "30 min", cook_time: "0 min", calories: "280 kcal" },
    { name: "Chicken Tikka Masala", cuisine: "Indian", prep_time: "20 min", cook_time: "35 min", calories: "540 kcal" },
    { name: "French Onion Soup", cuisine: "French", prep_time: "15 min", cook_time: "45 min", calories: "310 kcal" },
    { name: "Falafel Wrap", cuisine: "Middle Eastern", prep_time: "25 min", cook_time: "10 min", calories: "420 kcal" },
  ],
  "Sports & Fitness": [
    { match: "Lakers vs Warriors", score: "112 – 108", status: "Final", venue: "Chase Center", mvp: "Stephen Curry" },
    { match: "Man City vs Liverpool", score: "2 – 1", status: "Full Time", venue: "Etihad Stadium", mvp: "Haaland" },
    { match: "Yankees vs Red Sox", score: "5 – 3", status: "Final", venue: "Fenway Park", mvp: "Aaron Judge" },
    { match: "Djokovic vs Alcaraz", score: "6-4, 3-6, 7-5", status: "Completed", venue: "Roland Garros", mvp: "Alcaraz" },
    { match: "Chiefs vs Eagles", score: "31 – 24", status: "Final", venue: "State Farm Stadium", mvp: "Mahomes" },
    { match: "Maple Leafs vs Canadiens", score: "4 – 2", status: "Final", venue: "Bell Centre", mvp: "Matthews" },
  ],
  Transportation: [
    { flight: "UA 328", route: "SFO → JFK", departure: "08:45 AM", status: "On Time", aircraft: "Boeing 737-900" },
    { flight: "BA 178", route: "LHR → JFK", departure: "11:15 AM", status: "Boarding", aircraft: "A350-1000" },
    { flight: "DL 1492", route: "ATL → LAX", departure: "02:30 PM", status: "Delayed 45m", aircraft: "Boeing 757" },
    { flight: "SQ 22", route: "SIN → EWR", departure: "11:35 PM", status: "On Time", aircraft: "A350-900ULR" },
    { flight: "EK 215", route: "DXB → LAX", departure: "08:30 AM", status: "In Flight", aircraft: "A380-800" },
    { flight: "JL 006", route: "NRT → JFK", departure: "11:20 AM", status: "Scheduled", aircraft: "Boeing 777-300ER" },
  ],
  "Science & Math": [
    { element: "Carbon", symbol: "C", atomic_number: 6, atomic_mass: "12.011 u", category: "Nonmetal" },
    { element: "Gold", symbol: "Au", atomic_number: 79, atomic_mass: "196.97 u", category: "Transition Metal" },
    { element: "Oxygen", symbol: "O", atomic_number: 8, atomic_mass: "15.999 u", category: "Nonmetal" },
    { element: "Titanium", symbol: "Ti", atomic_number: 22, atomic_mass: "47.867 u", category: "Transition Metal" },
    { element: "Neon", symbol: "Ne", atomic_number: 10, atomic_mass: "20.180 u", category: "Noble Gas" },
    { element: "Iron", symbol: "Fe", atomic_number: 26, atomic_mass: "55.845 u", category: "Transition Metal" },
    { element: "Lithium", symbol: "Li", atomic_number: 3, atomic_mass: "6.941 u", category: "Alkali Metal" },
  ],
  Books: [
    { title: "The Pragmatic Programmer", author: "Thomas & Hunt", genre: "Software Engineering", pages: 352, rating: "4.8 / 5" },
    { title: "Dune", author: "Frank Herbert", genre: "Science Fiction", pages: 688, rating: "4.7 / 5" },
    { title: "Clean Code", author: "Robert C. Martin", genre: "Software Engineering", pages: 464, rating: "4.4 / 5" },
    { title: "Project Hail Mary", author: "Andy Weir", genre: "Science Fiction", pages: 496, rating: "4.9 / 5" },
    { title: "Atomic Habits", author: "James Clear", genre: "Self-Improvement", pages: 320, rating: "4.8 / 5" },
    { title: "The Three-Body Problem", author: "Cixin Liu", genre: "Science Fiction", pages: 400, rating: "4.3 / 5" },
  ],
  Video: [
    { title: "Inception", director: "Christopher Nolan", year: 2010, rating: "8.8 / 10", runtime: "2h 28m" },
    { title: "Parasite", director: "Bong Joon-ho", year: 2019, rating: "8.5 / 10", runtime: "2h 12m" },
    { title: "Oppenheimer", director: "Christopher Nolan", year: 2023, rating: "8.3 / 10", runtime: "3h 0m" },
    { title: "Everything Everywhere", director: "Daniels", year: 2022, rating: "7.8 / 10", runtime: "2h 19m" },
    { title: "Dune: Part Two", director: "Denis Villeneuve", year: 2024, rating: "8.5 / 10", runtime: "2h 46m" },
    { title: "The Grand Budapest Hotel", director: "Wes Anderson", year: 2014, rating: "8.1 / 10", runtime: "1h 39m" },
    { title: "Spider-Verse", director: "Thompson / Powers", year: 2023, rating: "8.7 / 10", runtime: "2h 20m" },
    { title: "Whiplash", director: "Damien Chazelle", year: 2014, rating: "8.5 / 10", runtime: "1h 47m" },
  ],
  Anime: [
    { title: "Attack on Titan", studio: "MAPPA", episodes: 87, score: "9.0 / 10", genres: "Action, Drama" },
    { title: "Fullmetal Alchemist: Brotherhood", studio: "Bones", episodes: 64, score: "9.2 / 10", genres: "Action, Fantasy" },
    { title: "Demon Slayer", studio: "ufotable", episodes: 44, score: "8.5 / 10", genres: "Action, Supernatural" },
    { title: "Jujutsu Kaisen", studio: "MAPPA", episodes: 47, score: "8.7 / 10", genres: "Action, Supernatural" },
    { title: "Spy × Family", studio: "Wit / CloverWorks", episodes: 37, score: "8.6 / 10", genres: "Action, Comedy" },
    { title: "Vinland Saga", studio: "Wit → MAPPA", episodes: 48, score: "8.8 / 10", genres: "Action, Historical" },
  ],
  "Currency Exchange": [
    { base: "USD", EUR: 0.9241, GBP: 0.7892, JPY: 149.82, CAD: 1.3614 },
    { base: "EUR", USD: 1.0821, GBP: 0.8540, JPY: 162.12, CHF: 0.9642 },
    { base: "GBP", USD: 1.2671, EUR: 1.1709, JPY: 189.83, AUD: 1.9612 },
    { base: "JPY", USD: 0.00668, EUR: 0.00617, GBP: 0.00527, KRW: 8.91 },
    { base: "CAD", USD: 0.7345, EUR: 0.6789, GBP: 0.5801, AUD: 1.0842 },
    { base: "AUD", USD: 0.6467, EUR: 0.5976, GBP: 0.5099, NZD: 1.0985 },
  ],
  Health: [
    { condition: "Type 2 Diabetes", icd_code: "E11", category: "Endocrine", prevalence: "~462M worldwide" },
    { condition: "Hypertension", icd_code: "I10", category: "Cardiovascular", prevalence: "~1.28B worldwide" },
    { condition: "Asthma", icd_code: "J45", category: "Respiratory", prevalence: "~262M worldwide" },
    { condition: "Major Depression", icd_code: "F32", category: "Mental Health", prevalence: "~280M worldwide" },
    { condition: "Osteoarthritis", icd_code: "M15-M19", category: "Musculoskeletal", prevalence: "~528M worldwide" },
    { condition: "Migraine", icd_code: "G43", category: "Neurological", prevalence: "~1B worldwide" },
  ],
  "Text Analysis": [
    { text: "Elon Musk visited Tesla HQ in Austin.", language: "English", sentiment: "Neutral", entities: "Musk (Person), Tesla (Org)" },
    { text: "I absolutely love this new product!", language: "English", sentiment: "Very Positive", entities: "None detected" },
    { text: "Le président a annoncé de nouvelles mesures.", language: "French", sentiment: "Neutral", entities: "président (Role)" },
    { text: "The server returned a 503 error at 3am.", language: "English", sentiment: "Negative", entities: "503 (Error), 3am (Time)" },
    { text: "Tokyo reported record cherry blossom dates.", language: "English", sentiment: "Positive", entities: "Tokyo (Location)" },
  ],
  Photography: [
    { title: "Golden Gate at Dusk", photographer: "Alex Morgan", camera: "Sony A7R V", aperture: "f/8", iso: 200 },
    { title: "Northern Lights", photographer: "Eira Svensson", camera: "Nikon Z9", aperture: "f/2.8", iso: 3200 },
    { title: "Street Market, Marrakech", photographer: "Youssef Amin", camera: "Fuji X-T5", aperture: "f/4", iso: 800 },
    { title: "Misty Forest", photographer: "Lena Park", camera: "Canon R5", aperture: "f/5.6", iso: 400 },
    { title: "Urban Geometry", photographer: "Max Weber", camera: "Leica Q3", aperture: "f/2", iso: 100 },
    { title: "Hummingbird in Flight", photographer: "Sofia Reyes", camera: "Sony A1", aperture: "f/6.3", iso: 1600 },
  ],
  Environment: [
    { location: "Los Angeles, CA", aqi: 87, quality: "Moderate", pm2_5: "18.3 µg/m³", pm10: "34.1 µg/m³" },
    { location: "Beijing, China", aqi: 162, quality: "Unhealthy", pm2_5: "78.4 µg/m³", pm10: "112.7 µg/m³" },
    { location: "Stockholm, Sweden", aqi: 28, quality: "Good", pm2_5: "5.1 µg/m³", pm10: "12.3 µg/m³" },
    { location: "Delhi, India", aqi: 214, quality: "Very Unhealthy", pm2_5: "124.8 µg/m³", pm10: "189.2 µg/m³" },
    { location: "Vancouver, Canada", aqi: 41, quality: "Good", pm2_5: "8.7 µg/m³", pm10: "18.9 µg/m³" },
  ],
  Email: [
    { email: "user@example.com", valid: true, deliverable: true, domain: "example.com", disposable: false },
    { email: "info@company.io", valid: true, deliverable: true, domain: "company.io", disposable: false },
    { email: "test@tempmail.xyz", valid: true, deliverable: false, domain: "tempmail.xyz", disposable: true },
    { email: "admin@startup.dev", valid: true, deliverable: true, domain: "startup.dev", disposable: false },
    { email: "bounce@invalid.test", valid: false, deliverable: false, domain: "invalid.test", disposable: false },
  ],
  Personality: [
    { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs", category: "Motivation" },
    { quote: "Be the change you wish to see in the world.", author: "Mahatma Gandhi", category: "Philosophy" },
    { quote: "In the middle of difficulty lies opportunity.", author: "Albert Einstein", category: "Perseverance" },
    { quote: "Stay hungry, stay foolish.", author: "Stewart Brand", category: "Innovation" },
    { quote: "The best time to plant a tree was 20 years ago.", author: "Chinese Proverb", category: "Wisdom" },
    { quote: "Talk is cheap. Show me the code.", author: "Linus Torvalds", category: "Technology" },
    { quote: "Simplicity is the ultimate sophistication.", author: "Leonardo da Vinci", category: "Design" },
  ],
  Entertainment: [
    { question: "What is the largest planet in our solar system?", answer: "Jupiter", category: "Science", difficulty: "Easy" },
    { question: "Who painted the Mona Lisa?", answer: "Leonardo da Vinci", category: "Art", difficulty: "Easy" },
    { question: "What year did the Berlin Wall fall?", answer: "1989", category: "History", difficulty: "Medium" },
    { question: "What element has the chemical symbol 'Au'?", answer: "Gold", category: "Science", difficulty: "Medium" },
    { question: "In what country would you find Machu Picchu?", answer: "Peru", category: "Geography", difficulty: "Medium" },
    { question: "What is the smallest prime number?", answer: "2", category: "Math", difficulty: "Easy" },
  ],
  "Test Data": [
    { name: "Alexandra Chen", email: "a.chen@fakemail.dev", phone: "+1 (415) 555-0192", city: "Portland, OR" },
    { name: "Marcus Johnson", email: "m.johnson@test.io", phone: "+1 (212) 555-0847", city: "New York, NY" },
    { name: "Yuki Tanaka", email: "y.tanaka@sample.jp", phone: "+81 90-1234-5678", city: "Osaka, Japan" },
    { name: "Priya Sharma", email: "p.sharma@demo.in", phone: "+91 98765-43210", city: "Mumbai, India" },
    { name: "Leo Müller", email: "l.muller@faker.de", phone: "+49 170 1234567", city: "Berlin, Germany" },
    { name: "Sofia Rossi", email: "s.rossi@mock.it", phone: "+39 333 1234567", city: "Milan, Italy" },
  ],
  Government: [
    { dataset: "US Population by State 2024", records: 51, source: "Census Bureau", format: "JSON / CSV", license: "Public Domain" },
    { dataset: "UK Crime Statistics 2024", records: "2.1M", source: "Home Office", format: "CSV", license: "OGL v3.0" },
    { dataset: "EU Air Quality Index", records: "450K", source: "EEA", format: "JSON / XML", license: "CC BY 4.0" },
    { dataset: "Canada Immigration Stats", records: "184K", source: "IRCC", format: "CSV", license: "Open Government" },
    { dataset: "Australia Employment Data", records: "8,200", source: "ABS", format: "JSON", license: "CC BY 4.0" },
    { dataset: "India GDP by State", records: 36, source: "MoSPI", format: "JSON / XLSX", license: "Government Open Data" },
  ],
  "Open Data": [
    { dataset: "Global Earthquake Events 2024", records: "14,200", source: "USGS", updated: "Real-time", license: "Public Domain" },
    { dataset: "World Bank Indicators", records: "1.4M", source: "World Bank", updated: "Annually", license: "CC BY 4.0" },
    { dataset: "NYC Taxi Trips", records: "112M", source: "TLC", updated: "Monthly", license: "Public Domain" },
    { dataset: "NOAA Climate Normals", records: "9,800", source: "NOAA", updated: "Decadal", license: "Public Domain" },
    { dataset: "OpenStreetMap Amenities", records: "500M+", source: "OSM", updated: "Continuous", license: "ODbL" },
  ],
  Security: [
    { ip: "192.168.1.1", threat_score: 12, malicious: false, country: "United States", reports: 3 },
    { ip: "45.33.32.156", threat_score: 78, malicious: true, country: "Unknown (VPN)", reports: 142 },
    { ip: "203.0.113.42", threat_score: 45, malicious: false, country: "Japan", reports: 18 },
    { ip: "91.108.56.100", threat_score: 5, malicious: false, country: "United Kingdom", reports: 0 },
    { ip: "185.220.101.1", threat_score: 95, malicious: true, country: "Germany (Tor Exit)", reports: 2841 },
  ],
  "Anti-Malware": [
    { file: "setup.exe", verdict: "Clean", engines_detected: "0 / 72", scan_date: "2026-02-25", file_size: "14.2 MB" },
    { file: "invoice.pdf.exe", verdict: "Malicious", engines_detected: "58 / 72", scan_date: "2026-02-24", file_size: "892 KB" },
    { file: "npm-package.tgz", verdict: "Suspicious", engines_detected: "3 / 72", scan_date: "2026-02-25", file_size: "1.1 MB" },
    { file: "photo.jpg", verdict: "Clean", engines_detected: "0 / 72", scan_date: "2026-02-23", file_size: "4.8 MB" },
  ],
  "Documents & Productivity": [
    { document: "Q4 2025 Report.pdf", pages: 24, words: "8,420", language: "English", author: "Jane Smith" },
    { document: "Design System v3.figma", pages: 186, words: "—", language: "—", author: "Design Team" },
    { document: "API Reference.md", pages: 42, words: "12,600", language: "English", author: "DevOps" },
    { document: "Sprint Retrospective.docx", pages: 3, words: "1,240", language: "English", author: "Scrum Master" },
    { document: "Financial Model.xlsx", pages: 8, words: "—", language: "—", author: "Finance Team" },
    { document: "User Research Notes.pdf", pages: 16, words: "5,800", language: "English", author: "UX Research" },
  ],
  Shopping: [
    { product: "Sony WH-1000XM5", price: "$349.99", rating: "4.7 / 5", reviews: "12,483", in_stock: true },
    { product: "MacBook Air M3", price: "$1,099", rating: "4.8 / 5", reviews: "8,921", in_stock: true },
    { product: "Kindle Paperwhite", price: "$139.99", rating: "4.6 / 5", reviews: "45,210", in_stock: true },
    { product: "Dyson V15 Detect", price: "$749.99", rating: "4.5 / 5", reviews: "6,843", in_stock: false },
    { product: "AirPods Pro 2", price: "$249", rating: "4.7 / 5", reviews: "31,204", in_stock: true },
  ],
  Blockchain: [
    { tx_hash: "0x3a4e...9f2b", block: "19,482,031", value: "1.284 ETH", gas_fee: "0.0024 ETH", status: "Confirmed" },
    { tx_hash: "0x8bc1...4d7f", block: "19,482,044", value: "0.5 ETH", gas_fee: "0.0018 ETH", status: "Confirmed" },
    { tx_hash: "0xf29d...a103", block: "19,482,050", value: "12.0 ETH", gas_fee: "0.0031 ETH", status: "Pending" },
    { tx_hash: "0x12ab...ee56", block: "19,481,998", value: "0.025 ETH", gas_fee: "0.0009 ETH", status: "Confirmed" },
  ],
  Dictionaries: [
    { word: "ephemeral", pronunciation: "/ɪˈfɛm.ər.əl/", part_of_speech: "adjective", definition: "Lasting for a very short time." },
    { word: "serendipity", pronunciation: "/ˌser.ənˈdɪp.ɪ.ti/", part_of_speech: "noun", definition: "Finding good things by chance." },
    { word: "ubiquitous", pronunciation: "/juːˈbɪk.wɪ.təs/", part_of_speech: "adjective", definition: "Present everywhere." },
    { word: "eloquent", pronunciation: "/ˈel.ə.kwənt/", part_of_speech: "adjective", definition: "Fluent or persuasive in speech." },
    { word: "pragmatic", pronunciation: "/præɡˈmæt.ɪk/", part_of_speech: "adjective", definition: "Dealing in a practical way." },
  ],
  "Art & Design": [
    { palette: "Sunset Gradient", colors: "#FF6B6B, #FFE66D, #FF8E53", mood: "Warm, Energetic" },
    { palette: "Ocean Depths", colors: "#0A1628, #1B4965, #5FA8D3", mood: "Cool, Calm" },
    { palette: "Forest Canopy", colors: "#2D6A4F, #52B788, #B7E4C7", mood: "Natural, Fresh" },
    { palette: "Midnight Purple", colors: "#2D1B69, #7B2FF7, #C77DFF", mood: "Bold, Modern" },
    { palette: "Terracotta Clay", colors: "#A0522D, #D4A373, #FEFAE0", mood: "Earthy, Warm" },
  ],
  Calendar: [
    { country: "United States", holiday: "Memorial Day", date: "May 26, 2025", type: "Federal" },
    { country: "United Kingdom", holiday: "Spring Bank Holiday", date: "May 26, 2025", type: "Bank Holiday" },
    { country: "Japan", holiday: "Mountain Day", date: "August 11, 2025", type: "National" },
    { country: "India", holiday: "Diwali", date: "October 20, 2025", type: "National" },
    { country: "Germany", holiday: "Tag der Deutschen Einheit", date: "October 3, 2025", type: "National" },
    { country: "Brazil", holiday: "Dia da Independência", date: "September 7, 2025", type: "National" },
  ],
  "URL Shorteners": [
    { short_url: "https://bit.ly/4xKp9Qm", clicks: 1842, created: "Feb 20, 2026", expires: "Never" },
    { short_url: "https://t.ly/abc123", clicks: 523, created: "Jan 5, 2026", expires: "Mar 5, 2026" },
    { short_url: "https://rb.gy/xyz789", clicks: 12401, created: "Dec 1, 2025", expires: "Never" },
    { short_url: "https://is.gd/demo42", clicks: 89, created: "Feb 24, 2026", expires: "Never" },
  ],
  "Data Validation": [
    { input: "+1 (415) 555-0192", type: "Phone Number", valid: true, country: "United States", carrier: "AT&T" },
    { input: "user@company.com", type: "Email", valid: true, country: "—", carrier: "—" },
    { input: "192.168.1.256", type: "IP Address", valid: false, country: "—", carrier: "—" },
    { input: "4111-1111-1111-1111", type: "Credit Card", valid: true, country: "United States", carrier: "Visa" },
    { input: "ABC 123 XY", type: "License Plate", valid: true, country: "United Kingdom", carrier: "—" },
  ],
  Phone: [
    { number: "+44 20 7946 0958", country: "United Kingdom", region: "London", carrier: "BT Group", type: "Landline" },
    { number: "+1 212 555 0147", country: "United States", region: "New York", carrier: "Verizon", type: "Mobile" },
    { number: "+81 3-1234-5678", country: "Japan", region: "Tokyo", carrier: "NTT DoCoMo", type: "Mobile" },
    { number: "+49 30 12345678", country: "Germany", region: "Berlin", carrier: "Deutsche Telekom", type: "Landline" },
  ],
  "Cloud Storage & File Sharing": [
    { filename: "project-final-v3.zip", size: "48.2 MB", uploaded: "Feb 24, 2026", downloads: 127, shared_with: 4 },
    { filename: "presentation.pptx", size: "12.8 MB", uploaded: "Feb 22, 2026", downloads: 43, shared_with: 12 },
    { filename: "dataset.parquet", size: "2.1 GB", uploaded: "Feb 20, 2026", downloads: 8, shared_with: 2 },
    { filename: "backup-2026-02.tar.gz", size: "890 MB", uploaded: "Feb 25, 2026", downloads: 1, shared_with: 1 },
  ],
  "Authentication & Authorization": [
    { user_id: "usr_8Kp2xNq4mT", email: "admin@acme.com", role: "admin", mfa: true, last_login: "2m ago" },
    { user_id: "usr_Lm7dRf3pWs", email: "dev@startup.io", role: "developer", mfa: true, last_login: "1h ago" },
    { user_id: "usr_Qx9vBn6jKe", email: "viewer@org.com", role: "read-only", mfa: false, last_login: "3d ago" },
  ],
  Programming: [
    { language: "Python", version: "3.12.2", paradigm: "Multi-paradigm", typing: "Dynamic", designed_by: "Guido van Rossum" },
    { language: "Rust", version: "1.76.0", paradigm: "Multi-paradigm", typing: "Static", designed_by: "Graydon Hoare" },
    { language: "TypeScript", version: "5.4.2", paradigm: "Multi-paradigm", typing: "Static", designed_by: "Anders Hejlsberg" },
    { language: "Go", version: "1.22.1", paradigm: "Concurrent, Imperative", typing: "Static", designed_by: "Pike, Thompson, Griesemer" },
  ],
  Vehicle: [
    { vin: "1HGBH41JXMN109186", make: "Honda", model: "Civic", year: 2022, engine: "1.5L Turbo", fuel: "Gasoline" },
    { vin: "5YJ3E1EA7LF123456", make: "Tesla", model: "Model 3", year: 2024, engine: "Electric", fuel: "Electric" },
    { vin: "WBA5R7C55KAJ12345", make: "BMW", model: "330i", year: 2023, engine: "2.0L Turbo", fuel: "Gasoline" },
    { vin: "JTDKN3DU5A0123456", make: "Toyota", model: "Prius", year: 2025, engine: "1.8L Hybrid", fuel: "Hybrid" },
  ],
  Tracking: [
    { tracking: "1Z999AA10123456784", carrier: "UPS", status: "Out for Delivery", eta: "Today by 8PM", destination: "Brooklyn, NY" },
    { tracking: "9400111899223100001", carrier: "USPS", status: "In Transit", eta: "Feb 27", destination: "Austin, TX" },
    { tracking: "7489284920182", carrier: "FedEx", status: "Delivered", eta: "—", destination: "Seattle, WA" },
    { tracking: "JD014600003592330555", carrier: "DHL", status: "Customs Clearance", eta: "Mar 1", destination: "Chicago, IL" },
  ],
  Business: [
    { company: "Acme Corp", industry: "Software", founded: 2012, employees: "501–1,000", revenue: "$48M ARR" },
    { company: "Bolt Logistics", industry: "Shipping", founded: 2018, employees: "51–200", revenue: "$12M ARR" },
    { company: "Novara Health", industry: "Healthcare", founded: 2015, employees: "201–500", revenue: "$32M ARR" },
    { company: "Zenith Labs", industry: "Biotech", founded: 2009, employees: "1,001–5,000", revenue: "$210M ARR" },
    { company: "Peak Digital", industry: "Marketing", founded: 2020, employees: "11–50", revenue: "$3.2M ARR" },
  ],
  "Continuous Integration": [
    { pipeline: "main-build", status: "passed", duration: "4m 12s", branch: "main", tests: "247 / 247" },
    { pipeline: "pr-check", status: "failed", duration: "2m 48s", branch: "feat/auth", tests: "244 / 247" },
    { pipeline: "nightly-e2e", status: "passed", duration: "18m 5s", branch: "main", tests: "1,024 / 1,024" },
    { pipeline: "deploy-staging", status: "running", duration: "1m 33s", branch: "release/v2.1", tests: "—" },
  ],
  "Open Source Projects": [
    { name: "VS Code", license: "MIT", stars: "162K", contributors: "1,900+", latest: "v1.87.0" },
    { name: "Next.js", license: "MIT", stars: "124K", contributors: "3,200+", latest: "v16.1.6" },
    { name: "PostgreSQL", license: "PostgreSQL", stars: "15.8K", contributors: "800+", latest: "v16.2" },
    { name: "Tailwind CSS", license: "MIT", stars: "81K", contributors: "400+", latest: "v4.2.1" },
  ],
  Patent: [
    { patent: "US10,123,456", title: "Neural Network Optimization", assignee: "Acme Technologies", filed: "2021", status: "Active" },
    { patent: "US11,987,654", title: "Quantum Error Correction Method", assignee: "QBit Inc.", filed: "2022", status: "Active" },
    { patent: "EP3,456,789", title: "Biodegradable Polymer Composition", assignee: "GreenChem AG", filed: "2020", status: "Active" },
  ],
  Events: [
    { event: "PyCon US 2026", date: "May 14–22, 2026", location: "Pittsburgh, PA", tickets: "From $125" },
    { event: "React Summit", date: "Jun 13, 2026", location: "Amsterdam", tickets: "From €399" },
    { event: "WWDC 2026", date: "Jun 8–12, 2026", location: "Cupertino, CA", tickets: "Free (online)" },
  ],
};

// ── Infer fields to display from a sample object ──────────────────────────────
function inferDisplayFields(sample) {
  return Object.keys(sample).slice(0, 5);
}

// ── Build a preview from a variant ────────────────────────────────────────────
function buildPreview(slug, name, desc, cat) {
  const pool = VARIANTS[cat];
  if (!pool) {
    // Fallback: generic API-info card
    const hash = hashIndex(slug, 97); // prime for better distribution
    return {
      id: slug,
      previewType: "card",
      sampleResponse: {
        endpoint: `GET /v1/${slug}`,
        response_time: `${80 + (hash % 200)}ms`,
        status: "200 OK",
        records: 10 + (hash % 990),
        rate_limit: `${(hash % 5 + 1) * 500} req/day`,
      },
      previewConfig: {
        title: name,
        subtitle: desc,
        displayFields: ["endpoint", "response_time", "status", "records", "rate_limit"],
      },
    };
  }

  // Handle list-type categories
  if (pool.type === "list") {
    const idx = hashIndex(slug, pool.variants.length);
    const items = pool.variants[idx];
    const config = {
      title: name,
      subtitle: desc,
    };
    // Detect keys from first item
    const first = items[0];
    const keys = Object.keys(first);
    if (keys.length >= 1) config.itemKey = keys[0];
    if (keys.length >= 2) config.secondaryKey = keys[1];
    if (keys.length >= 3) config.badgeKey = keys[2];

    return {
      id: slug,
      previewType: "list",
      sampleResponse: { items },
      previewConfig: config,
    };
  }

  // Card-type categories (pool is an array of sample objects)
  const idx = hashIndex(slug, pool.length);
  const sample = pool[idx];

  return {
    id: slug,
    previewType: "card",
    sampleResponse: sample,
    previewConfig: {
      title: name,
      subtitle: desc,
      displayFields: inferDisplayFields(sample),
    },
  };
}

// ── Main ────────────────────────────────────────────────────────────────────

let updated = 0;
let skipped = 0;

for (const entry of catalog.entries) {
  const slug = slugify(entry.API);
  const filePath = path.join(previewDir, `${slug}.json`);

  if (!fs.existsSync(filePath)) continue;

  const existing = JSON.parse(fs.readFileSync(filePath, "utf-8"));

  if (!shouldRegenerate(existing)) {
    skipped++;
    continue;
  }

  const preview = buildPreview(slug, entry.API, entry.Description, entry.Category);
  fs.writeFileSync(filePath, JSON.stringify(preview, null, 2) + "\n");
  updated++;
}

console.log(`Updated: ${updated} previews with unique per-API data`);
console.log(`Skipped: ${skipped} hand-crafted previews (untouched)`);

// Verify uniqueness
const byCat = {};
for (const entry of catalog.entries) {
  const slug = slugify(entry.API);
  const filePath = path.join(previewDir, `${slug}.json`);
  if (!fs.existsSync(filePath)) continue;
  const d = JSON.parse(fs.readFileSync(filePath, "utf-8"));
  const key = JSON.stringify(d.sampleResponse);
  const cat = entry.Category;
  if (!byCat[cat]) byCat[cat] = new Set();
  byCat[cat].add(key);
}
let totalUnique = 0;
for (const [cat, set] of Object.entries(byCat)) {
  totalUnique += set.size;
}
console.log(`Unique preview variants across all categories: ${totalUnique}`);
